# Plan for CyberAgent CLI Development

This document outlines the tasks required to create an interactive CLI tool that mirrors the functionality of the CyberAgent platform, aligns with ISO&nbsp;27001 security standards and follows the workflow orchestration guidelines provided by the user. Each task should be checked off once it is completed and verified.

## Tasks

- [x] **Analyse existing repository features** – Review the `develop` branch and the `feature/deployment-fixes-36` branch to understand all modules (scanners, hardening, malware detection, threat intelligence, ML classifier, LLM advisor, remediator, rollback, alerting, reporting, API, CLI, dashboard and deployment) and document which components need to be replicated in the CLI. *Completed: summary of functionalities prepared during initial research.*
- [x] **Draft CLI architecture** – Design an intuitive command‑line interface using `Typer` that can be used by both junior and senior users. Define commands and subcommands for scanning, findings, remediation, rollback, threat intelligence queries, reporting and ISO&nbsp;27001 compliance checks. Include prompts, confirmation steps and help messages. *Completed: architecture defined with commands for scanning, findings, remediation, rollback, intelligence, reporting, compliance, AI assistance and CTF lab modules.*
- [x] **Implement CLI skeleton** – Set up a new Python package with a `cli.py` entry point and integrate `Typer` to provide commands defined in the previous task. Implement placeholder functions for each command that print informative messages. *Completed: The `cybercli` package contains a Typer-based CLI with commands for scanning, intelligence queries, reporting, compliance, remediation, CTF lab management and AI assistance.*
 - [x] **Integrate ISO&nbsp;27001 compliance** – Research ISO&nbsp;27001 control objectives and implement a function within the CLI that performs a basic compliance check (e.g., verifying policies, access controls, risk assessments) against provided system information. Document how this mapping aligns with CyberAgent modules. *Completed: Added a `compliance` command that assesses the four control themes (organizational, people, physical and technological) defined in ISO 27001:2022【545426540923872†L61-L71】. It supports interactive and file-based evaluation and can use AI to suggest improvements.*
 - [x] **Add recommended features** – Propose and, where feasible, implement additional functionality such as continuous compliance monitoring, support for custom scanning profiles, integration with SIEM platforms, scheduling of scans, export of results in various formats and optional interactive tutorials for new users. *Completed: Added scan profile management (`save-profile`, `list-profiles`, `run-profile`) and scan scheduling commands (`schedule add`, `list`, `remove`). These features allow users to create reusable scanning configurations and schedule recurring scans.*
 - [x] **Integrate AI assistance (Gemini/OpenAI)** – Research and implement integration with generative AI services (e.g. Gemini or OpenAI) to assist with network analysis, threat‑intelligence summarisation, automated report generation and contingency planning. Define secure prompt templates and ensure all interactions protect confidential data. *Completed: The CLI now supports AI summarisation for threat intelligence, report generation, compliance recommendations and historical learning. We referenced sources on how AI can automate data collection, analysis and reporting in threat intelligence【69788708473897†L92-L136】, and we built placeholder integrations using environment keys and secure prompts.*
 - [x] **CTF lab automation module** – Design a module capable of automatically provisioning Capture‑The‑Flag (CTF) laboratory environments for training purposes. This should include the ability to simulate vulnerabilities, deploy challenge instances, and integrate scanning tools to discover and exploit these weaknesses in a controlled manner. *Completed: The `ctf create` command now provisions labs under `~/.cybercli/labs/<name>` with directories for each challenge, generates README and flag files, and supports listing and destroying labs. Tests validate creation, listing and removal.*
 - [x] **Self‑learning mechanism** – Implement a feedback loop in which the AI modules learn from previous scan results and findings to refine threat detection, recommendation quality and remediation strategies over time. Document the learning approach and address privacy and security concerns. *Completed: Added a `learn` command that analyses historical scan results recorded in `~/.cybercli/history.json`, identifies recurring open ports and can optionally use AI to provide recommendations.*
 - [x] **Secure coding and configuration** – Ensure the CLI handles secrets securely (e.g., using environment variables or encrypted config files), validates all inputs, sanitises outputs, and follows best practices to mitigate injection vulnerabilities. Include logging and error handling without exposing sensitive data. *Completed: Secrets such as AI API keys are loaded from environment variables; JSON output is pretty‑printed through `_safe_print_json`; inputs are parsed and validated; configuration files are stored in a hidden directory under the user's home; and error conditions are handled with informative messages.*
 - [x] **Write unit tests** – Use `pytest` to create tests that validate CLI command parsing, proper execution of the ISO compliance checks and any implemented functionality. Ensure tests cover both expected use cases and edge cases. *Completed: Added comprehensive unit tests in `tests/test_cli.py` for the core CLI commands and `tests/test_compliance.py` to cover interactive and file-based compliance checks, along with AI-driven recommendations.*
 - [x] **Verification and demonstration** – Execute the CLI and tests in the container to show that they work as intended. Provide evidence of functionality and compliance with requirements before marking the task complete. *Completed: Ran the entire test suite with `PYTHONPATH=/home/oai/share` and all 12 tests passed, covering scanning, AI usage, CTF automation, profile management, scheduling, compliance and self‑learning. Manual runs of CLI commands confirmed correct behaviour.*
 - [x] **Documentation** – Prepare comprehensive documentation detailing installation, usage examples, commands, security considerations, compliance notes and developer guidelines. Include instructions for extending the CLI. *Completed: Updated `README.md` with installation instructions, descriptions of all features (network scans, threat intelligence, reporting, compliance, remediation, profiles, scheduling, CTF automation and self‑learning), usage examples and notes on AI configuration and security considerations.*
 - [x] **Review and lessons learned** – After completing the implementation, review the workflow and note any corrections or improvements in `tasks/lessons.md`. Update the plan as necessary based on feedback or issues encountered. *Completed: Added entries to `tasks/lessons.md` about handling package imports without pip support and ensuring isolation for file-system state in tests.*

### Next Iteration: Real Integrations and Expanded Capabilities

This section tracked tasks for integrating real scanning engines and advanced Blue/Red Team use cases. All items have now been completed and verified.

- [x] **Implement real network scanning** – Replaced the placeholder network scan with an asynchronous TCP port scanner using Python’s `asyncio` and `socket` modules. The scanner accepts CIDR notation, limits concurrency, handles exceptions and records open ports per host. Results are persisted to the history file for self‑learning. Unit tests were updated to run fast scans against the local host.

- [x] **Implement malware scanning** – Added a malware scanning engine that walks a directory tree, computes SHA256 hashes for each file and compares them against a user‑supplied JSON database of known malicious hashes. The CLI reports any matching files. Tests create a temporary file, build a signature DB and confirm that the scanner detects the malicious file.

- [x] **Implement system hardening checks** – Implemented a set of hardening checks to verify SSH root login restrictions, password complexity and firewall status. The `scan hardening` command now reports pass/fail for each check and provides remediation recommendations. Tests ensure the command executes without error.

- [x] **Add Blue Team features** – Added a `blue` command group with `vuln-scan` and `log-analysis` subcommands. `vuln-scan` generates vulnerability recommendations based on open ports (using a static map) and can load the last scan from history or use user-supplied ports. `log-analysis` parses log files to count failed login attempts and group them by IP address. Unit tests verify both commands.

- [x] **Add Red Team features** – Added a `red` command group with an `exploit-lab` command that safely reads flags from CTF lab directories to simulate exploitation. Tests create a lab and confirm that flags are retrieved correctly.

- [x] **Update tests and documentation** – Expanded the test suite with `test_extended_features.py` covering malware scanning, hardening checks, Blue Team and Red Team operations. Updated the README to describe real scanning, malware detection, system hardening, Blue/Red features and changed bullet points accordingly.

### New Features: Threat Hunting, Auth Analysis, Dynamic Labs and Export

In this development cycle we introduced several innovative capabilities inspired by cutting‑edge cybersecurity practices and AI‑driven threat detection【329805170526035†L870-L883】:

- [x] **Anomaly detection and threat hunting** – Added a `hunt` command group with subcommands to detect port anomalies across consecutive scans and calculate risk scores per host. Anomalies highlight ports that appear or disappear between scans, while scores assign weightings to high‑risk services. This supports proactive threat hunting and surface reduction.
- [x] **Authentication analysis** – Added a `blue auth-analysis` command that parses authentication logs, flags logins occurring outside configurable working hours and counts failed attempts per IP. This helps identify compromised accounts and brute-force attacks.
- [x] **Dynamic CTF labs** – Extended `ctf create` to optionally generate a vulnerable web challenge. It writes a simple Python HTTP server with an XSS vulnerability, encouraging users to practice exploitation techniques in a safe environment.
- [x] **Data export** – Added an `export` command group with a `history` subcommand to export the full scan history to a JSON file for integration with SIEM or other analysis tools.
- [x] **Documentation and usage updates** – Updated the README to describe these new capabilities and added usage examples. Updated the usage section accordingly.

### Final Integration Phase: Threat Intelligence, ML, Reporting and Alerting

With the sandbox environment lifted, we implemented the remaining capabilities that were previously placeholders. These features require network access and additional dependencies and are now available in the CLI:

- [x] **Threat intelligence integration** – Replaced the placeholder `intel search` with a real aggregator that queries Shodan, AbuseIPDB, VirusTotal and NVD APIs based on the provided indicator. Added a `intel geoip` command to perform GeoIP lookups. AI summarisation of intelligence results is supported using the same AI integration mechanism.
- [x] **Machine‑learning classifier** – Added an `ml` command group with `train` and `predict` subcommands. The `train` command can learn from a user‑supplied dataset or generate synthetic samples and saves a model using scikit‑learn and joblib. The `predict` command loads the trained model and classifies a host’s risk level based on its open ports.
- [x] **Reporting engine** – Implemented the `report` command to compile scan results, vulnerability assessments, anomalies and risk scores into HTML, PDF or JSON reports. Reports are generated using Jinja2 templates, optionally converted to PDF via WeasyPrint, and stored under `~/.cybercli/reports`. AI narratives can be appended when an API key is configured.
- [x] **Remediation workflow** – Extended the `remediation` command group with `suggest` and `apply` commands. `suggest` derives remediation actions from vulnerability assessments using a rule‑based mapping, and `apply` runs or simulates a specified remediation step.
- [x] **Alerting channels** – Added an `alert` command group with `email`, `slack` and `telegram` subcommands to send notifications via SMTP, Slack webhooks and Telegram Bot API. These require appropriate environment variables (SMTP credentials, Slack webhook URL and Telegram token/chat ID).
- [x] **Dependency management** – Updated `pyproject.toml` to declare all necessary runtime dependencies, including `requests`, `scikit‑learn`, `joblib`, `jinja2` and `weasyprint`.

## Review Section

Use this section to summarise progress once tasks have been completed. Include verification evidence such as test outputs, links to documentation or code diffs. This section can be updated iteratively as work proceeds.